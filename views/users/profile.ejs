<%- include("headerUser") %> <%- include("navbarProfile") %>





<!-- css for justified Gallery -->
<link rel="stylesheet" href="../../JustifiedGalleryFiles/justifiedGallery.min.css" />


<!-- adding leaflet map links -->
<link
   rel="stylesheet"
   href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css"
/>

<style>
   #mapid {
      height: 90vh;
      width: 90vw;
      margin-left: auto;
      margin-right: auto;
   }

   #mapThumb{
      max-height: 50px;
      max-width: 50px;
   }
</style>

<p>photos:</p>

<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
   <ol class="carousel-indicators">
      <li
         data-target="#carouselExampleIndicators"
         data-slide-to="0"
         class="active"
      ></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
      <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
   </ol>
   <div class="carousel-inner">
      <div class="carousel-item active">
         <img class="caroImg" src="/images/_DSC0074-3.jpg" alt="First slide" />
      </div>
      <div class="carousel-item">
         <img class="caroImg" src="/images/_DSC0060.jpg" alt="Second slide" />
      </div>
      <div class="carousel-item">
         <img class="caroImg" src="/images/_DSC0058.jpg" alt="Third slide" />
      </div>
   </div>
   <a
      class="carousel-control-prev"
      href="#carouselExampleIndicators"
      role="button"
      data-slide="prev"
   >
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
   </a>
   <a
      class="carousel-control-next"
      href="#carouselExampleIndicators"
      role="button"
      data-slide="next"
   >
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
   </a>
   <a href="#" class="btn btn-primary">Contact</a>
</div>

<div class="container galleryContainer">
   <h1 class="sectionTitle">Galleries</h1>

   <div class="row">
      <figure class="col-lg-4 col-sm-12 img-fluid galleryfig">
         <a
            href="https://mdbootstrap.com/img/Photos/Horizontal/Nature/12-col/img%20(117).jpg"
         >
            <img alt="picture" src="/images/_DSC0074-3.jpg" class="img-fluid" />
         </a>

         <h4>Nature</h4>
         <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do
            eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
            ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
            aliquip ex ea commodo consequat. Duis aute irure dolor in
            reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
            pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
            culpa qui officia deserunt mollit anim id est laborum.
         </p>

         <button
            type="button"
            class="btn btn-primary btn-sm"
            href="#"
            name="button"
         >
            View Gallery
         </button>
      </figure>

      <figure class="col-lg-4 col-sm-12 img-fluid galleryfig">
         <a
            href="https://mdbootstrap.com/img/Photos/Horizontal/Nature/12-col/img%20(117).jpg"
         >
            <img alt="picture" src="/images/_DSC0074-3.jpg" class="img-fluid" />
         </a>

         <h4>Nature</h4>
         <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do
            eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
            ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
            aliquip ex ea commodo consequat. Duis aute irure dolor in
            reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
            pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
            culpa qui officia deserunt mollit anim id est laborum.
         </p>
      </figure>
      <figure class="col-lg-4 col-sm-12 img-fluid galleryfig">
         <a
            href="https://mdbootstrap.com/img/Photos/Horizontal/Nature/12-col/img%20(117).jpg"
         >
            <img alt="picture" src="/images/_DSC0074-3.jpg" class="img-fluid" />
         </a>

         <h4>Nature</h4>
         <p>
            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do
            eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
            ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
            aliquip ex ea commodo consequat. Duis aute irure dolor in
            reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
            pariatur. Excepteur sint occaecat cupidatat non proident, sunt in
            culpa qui officia deserunt mollit anim id est laborum.
         </p>
      </figure>
   </div>
</div>

<div
   id="mapid"
   style="width: 600px; height: 400px; position: relative; outline: none;"
   class="leaflet-container leaflet-retina leaflet-fade-anim leaflet-grab leaflet-touch-drag"
   tabindex="0"
>
   <div
      class="leaflet-pane leaflet-map-pane"
      style="transform: translate3d(0px, 0px, 0px);"
   >
      <div class="leaflet-pane leaflet-tile-pane">
         <div class="leaflet-layer" style="z-index: 1; opacity: 1;">
            <div
               class="leaflet-tile-container leaflet-zoom-animated"
               style="
                  z-index: 18;
                  transform: translate3d(0px, 0px, 0px) scale(1);
               "
            >
               <img
                  alt=""
                  role="presentation"
                  src="./Quick Start - Leaflet_files/1361"
                  class="leaflet-tile leaflet-tile-loaded"
                  style="
                     width: 512px;
                     height: 512px;
                     transform: translate3d(-200px, -347px, 0px);
                     opacity: 1;
                  "
               /><img
                  alt=""
                  role="presentation"
                  src="./Quick Start - Leaflet_files/1361(1)"
                  class="leaflet-tile leaflet-tile-loaded"
                  style="
                     width: 512px;
                     height: 512px;
                     transform: translate3d(312px, -347px, 0px);
                     opacity: 1;
                  "
               /><img
                  alt=""
                  role="presentation"
                  src="./Quick Start - Leaflet_files/1362"
                  class="leaflet-tile leaflet-tile-loaded"
                  style="
                     width: 512px;
                     height: 512px;
                     transform: translate3d(-200px, 165px, 0px);
                     opacity: 1;
                  "
               /><img
                  alt=""
                  role="presentation"
                  src="./Quick Start - Leaflet_files/1362(1)"
                  class="leaflet-tile leaflet-tile-loaded"
                  style="
                     width: 512px;
                     height: 512px;
                     transform: translate3d(312px, 165px, 0px);
                     opacity: 1;
                  "
               />
            </div>
         </div>
      </div>
      <div class="leaflet-pane leaflet-shadow-pane"></div>
      <div class="leaflet-pane leaflet-overlay-pane"></div>
      <div class="leaflet-pane leaflet-marker-pane"></div>
      <div class="leaflet-pane leaflet-tooltip-pane"></div>
      <div class="leaflet-pane leaflet-popup-pane"></div>
      <div
         class="leaflet-proxy leaflet-zoom-animated"
         style="transform: translate3d(1.04805e6px, 697379px, 0px) scale(4096);"
      ></div>
   </div>
   <div class="leaflet-control-container">
      <div class="leaflet-top leaflet-left">
         <div class="leaflet-control-zoom leaflet-bar leaflet-control">
            <a
               class="leaflet-control-zoom-in"
               href="https://leafletjs.com/examples/quick-start/example-basic.html#"
               title="Zoom in"
               role="button"
               aria-label="Zoom in"
               >+</a
            ><a
               class="leaflet-control-zoom-out"
               href="https://leafletjs.com/examples/quick-start/example-basic.html#"
               title="Zoom out"
               role="button"
               aria-label="Zoom out"
               >−</a
            >
         </div>
      </div>
      <div class="leaflet-top leaflet-right"></div>
      <div class="leaflet-bottom leaflet-left"></div>
      <div class="leaflet-bottom leaflet-right">
         <div class="leaflet-control-attribution leaflet-control">
            <a
               href="https://leafletjs.com/"
               title="A JS library for interactive maps"
               >Leaflet</a
            >
            | Map data ©
            <a href="https://www.openstreetmap.org/">OpenStreetMap</a>
            contributors,
            <a href="https://creativecommons.org/licenses/by-sa/2.0/"
               >CC-BY-SA</a
            >, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>
         </div>
      </div>
   </div>
</div>




<!-- gallery -->

<div id="photoGallery" >
   <a href="../../uploads/userImage-1595137025244-DSC_0004.jpg
   ">
       <img alt="Title 1" src="../../uploads/userImage-1595137025244-DSC_0004.jpg"/>
   </a>
   <a href="../../uploads/userImage-1595137025244-DSC_0004.jpg">
       <img alt="Title 2" src="../../uploads/userImage-1595137025244-DSC_0004.jpg"/>
   </a>
   <a href="https://images.unsplash.com/photo-1593642702821-c8da6771f0c6?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1400&q=60">
      <img alt="Title 2" src="../../uploads/userImage-1595137025244-DSC_0004.jpg"/>
  </a>
  <a href="https://images.unsplash.com/photo-1593642702821-c8da6771f0c6?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1400&q=60">
   <img alt="Title 2" src="../../uploads/userImage-1595137025244-DSC_0004.jpg"/>
</a>

   <!-- other images... -->
</div>

<!--gettting data to use in script --- might need to find better way to do this-- data esposed ad looks ugly-->
<p id="photoData" data-photos="<%= JSON.stringify(photoList)%>"></p>
   <%= JSON.stringify(photoList) %>
</p>




<div id="mapid"></div>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

<p><%= %></p>

<!-- TODO make sure images are loading with low bandwidth and not using too much resources -->
<!-- TODO-- exctract script file -->
<!-- TODO --  only run script if atleast one photo -->
<script>

//code adapted from here
//https://stackoverflow.com/questions/38170366/leaflet-adjust-popup-to-picture-size/38172374#38172374
////////////////////////
// document.querySelector(".leaflet-popup-pane").addEventListener("load", function (event) {
// 	var target = event.target,
//   		tagName = target.tagName,
//       popup = map._popup;
      
//   console.log("got load event from " + tagName);
  
//   if (tagName === "IMG" && popup) {
//   	popup.update();
//   }
// }, true);
///////////////////


   const photos = document.getElementById('photoData'); //.photos;
   photosJSON = JSON.parse(photos.dataset.photos);

   
   // TODO--do better job at handling empty list--right now only running script if a first element
   if (photosJSON[0]){
      //setting viewport variables (https://stackoverflow.com/questions/1248081/how-to-get-the-browser-viewport-dimensions)
      const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)
const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)


   var mymap = L.map('mapid').setView([20, 0], 1, {
      zoomControl: false,
   });
   mymap.scrollWheelZoom.disable();

   console.log(photosJSON[0]._id);
   photosJSON.forEach((photo) => {
      if (
         photo.latitude &&
          photo.latitude.length > 0 &&
             photo.longitude  &&
             photo.longitude.length > 0
      ) {
         // TODO--currently no safeguards against improper GPS coords
         //TODO -- seperate styles
               L.marker([photo.latitude , photo.longitude])
      .addTo(mymap).on('click', function() {console.log("click!");})

      
         console.log(photo.latitude + '----' + photo.longitude);
      } else {
         console.log('cannot get lon/lat');
      }

      console.log(photo);


   });


   

   function displayImage()  {
      console.log('ClickyClick!')
   }




   L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution:
         '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',
   }).addTo(mymap);

   }
</script>


<!-- jquerry -- needed for justified gallery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<!-- script for including justified gallery -->
<script src="../../JustifiedGalleryFiles/jquery.justifiedGallery.min.js"></script>

<!-- justified gallery script for page -->
<script>


      //setting viewport variables (https://stackoverflow.com/questions/1248081/how-to-get-the-browser-viewport-dimensions)
   const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0)
   const vh = Math.max(document.documentElement.clientHeight || 0, window.innerHeight || 0)


$('#photoGallery').justifiedGallery({
    rowHeight : Math.floor(vh/3),
    lastRow : 'nojustify',
    margins : 5
});
</script>

<%- include("footerUser") %>
