<%- include("../partials/header") %> <%- include("../partials/navbar") %>

<!-- css for justified Gallery -->
<link
   rel="stylesheet"
   href="../../JustifiedGalleryFiles/justifiedGallery.min.css"
/>

<h1></h1>
<!-- search bar for photos -->
<input type="text" id="photoSearch" placeholder="Serach photos" />

<!-- iamge gallery -->

<div id="photoGallery">
   <% photosFound.forEach((photo, ndx) =>{%>

   <a href="/photos/<%= photo._id %>/photo">
      <img
         class="justifiedGalImg"
         alt="<%= photo.caption %>"
         src="/uploads/<%= photo.fileName %>"
      />
   </a>

   <% })%>
</div>

<!-- jquerry -- needed for justified gallery -->
<script
   src="https://code.jquery.com/jquery-3.5.1.min.js"
   integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
   crossorigin="anonymous"
></script>

<!-- script for including justified gallery -->
<script src="../../JustifiedGalleryFiles/jquery.justifiedGallery.min.js"></script>

<!-- justified gallery script for page -->
<script>
   //setting viewport variables (https://stackoverflow.com/questions/1248081/how-to-get-the-browser-viewport-dimensions)
   // const vw = Math.max(
   //    document.documentElement.clientWidth || 0,
   //    window.innerWidth || 0,
   // );
   // const vh = Math.max(
   //    document.documentElement.clientHeight || 0,
   //    window.innerHeight || 0,
   // );

   // $('#photoGallery').justifiedGallery({
   //    rowHeight: Math.floor(vh / 3.3),
   //    lastRow: 'nojustify',
   //    margins: 20,
   //    lastRow: 'center',
   // });
</script>

<!-- script to get photos -->
<script>
   search = document.getElementById('photoSearch');

   const searchPhotos = async (searchText) => {
      const photoRes = await fetch(`../api/photos/?search=${searchText}`);

      /*setting page data to zero*/

      photoSearch = document.getElementById('photoSearch');

      if (photoRes.ok) {
         let photoJSON = await photoRes.json();
         console.log(photoRes);
         console.log(photoJSON);

         /*generating img gallery contents from search results */
         photoGallery = document.getElementById('photoGallery');

         photoGallery.innerHTML = `<a href="/photos/5f1e7a4635d1a837f0898602/photo">
      <img class="justifiedGalImg" alt="" src="https://secure.img1-fg.wfcdn.com/im/18187842/resize-h800%5Ecompr-r85/4307/43074506/Hanging+Golden+Retriever+Puppy+Statue.jpg">
   </a>`; //showResultsOnPage(photoJSON);
      } else {
         console.log('problem gettingJSON'); //TODO  -- better err handling
      }

      // return userJSON;
   };

   const showResultsOnPage = (photos) => {
      // TODO --fully test this function
      let html = '';
      if (photos.length > 0) {
         photos.forEach((photo) => {
            //note -- a more advanced version would allow for pagation

            html += `<a href="/photos/${photo._id}/photo">
      <img
         class="justifiedGalImg"
         alt="${photo.caption}"
         src="/uploads/${photo.fileName}"
      />
   </a>`;
         });
      } else {
         //TODO unneeded???
         html = '';
      }

      return html;
   };

   // photoGallery.innerHTML = `<a href="/photos/5f1e7a4635d1a837f0898602/photo">
   //    <img class="justifiedGalImg" alt="" src="https://secure.img1-fg.wfcdn.com/im/18187842/resize-h800%5Ecompr-r85/4307/43074506/Hanging+Golden+Retriever+Puppy+Statue.jpg">
   // </a>`;
   $(window).scroll(function () {
      console.log('change detected');
   });

   const vw = Math.max(
      document.documentElement.clientWidth || 0,
      window.innerWidth || 0,
   );
   const vh = Math.max(
      document.documentElement.clientHeight || 0,
      window.innerHeight || 0,
   );
   $('#photoGallery').justifiedGallery({
      rowHeight: Math.floor(vh / 3.3),
      lastRow: 'nojustify',
      margins: 20,
      lastRow: 'center',
   });
   // photoGallery.innerHTML = `<a href="/photos/5f1e7a4635d1a837f0898602/photo">
   //    <img class="justifiedGalImg" alt="" src="https://secure.img1-fg.wfcdn.com/im/18187842/resize-h800%5Ecompr-r85/4307/43074506/Hanging+Golden+Retriever+Puppy+Statue.jpg">
   // </a>`;

   // $('#photoGallery').justifiedGallery();

   search.addEventListener('input', () => searchPhotos(search.value));
</script>

<!-- footer -->
<%- include("../partials/footer") %>
